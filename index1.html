<!DOCTYPE html>
<html>

<head>
  <title>INFO 4310 HW4</title>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>
</body>

<script>
  var width = 1000;
  var height = 600;

  var svg = d3.select("body")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

  var g = svg.append("g");

  var projection = d3.geoMercator()
    .center([-79.9959, 40.4406])
    .scale(150000)
    .translate([width / 2, height / 2]);

  const path = d3.geoPath()
    .projection(projection);

  const color = d3.scaleOrdinal(d3.schemeCategory20c);

  d3.queue()
    .defer(d3.csv, "data/Yelp-Pittsburgh.m.csv")
    .defer(d3.json, "data/pittsburgh.geojson")
    .await(makeViz);

  function makeViz(error, restaurants, geojson) {

    console.log(restaurants.length);

    const validNeighborhoods = geojson.features.map(d => d.properties.name);

    //Filtering restaurants
    restaurants = restaurants.filter( d => validNeighborhoods.indexOf(d.neighborhood) > -1);

    console.log(restaurants.length);

    restaurants.forEach(function(d) {
      d["rating"] = Number(d["rating"]);
      d["review count"] = Number(d["review count"]);
      d["longitude"] = Number(d["longitude"]);
      d["latitude"] = Number(d["latitude"]);
    });

    g.selectAll("path")
      .data(geojson.features)
      .enter()
      .append("path")
      .attr("stroke", "black")
      .attr("fill", (d, i) => "#ccc")
      .attr("d", path);
      // .on("mouseover", mouseOverHandler)
      // .on("mouseout", mouseOutHandler)
      // .on("click", clickHandler);

    g.selectAll("circle")
      .data(restaurants).enter()
      .append("circle")
      .attr("cx", (d, i) => projection([d.longitude,d.latitude])[0])
      .attr("cy", (d, i) => projection([d.longitude, d.latitude])[1])
      .attr("r", 2)
      .attr("fill", "red")
      .on("mouseover", mouseover)

    var testText = g.append("text")
    .attr("x", 50)
    .attr("y", 50)
    .attr("stroke", "black")
    .text("Test");

    function mouseover(d){
      console.log(d);
      testText.text(d.neighborhood);
    }

    console.log(restaurants);
    console.log(geojson);

  }
</script>


</html>
